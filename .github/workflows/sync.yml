on:
  push:
    branches:
    - slave
  workflow_dispatch:
    
jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - run: |
        mkdir -p ~/.ssh
        echo "${{ secrets.SSH_KEY }}" >> ~/.ssh/mirror
        chmod 600 ~/.ssh/mirror
        echo ${{ secrets.FINGERPRINT }} >> ~/.ssh/known_hosts
        chmod 600 ~/.ssh/known_hosts
        export GIT_SSH_COMMAND="ssh -i ~/.ssh/mirror"
        export HF_TOKEN=${{ secrets.HF_TOKEN }}
        python3 -m venv .
        . bin/activate
        pip install -U  "huggingface_hub[cli]"
        git remote add mirror ${{ secrets.REPO }}
        git push -f mirror slave:main
        
